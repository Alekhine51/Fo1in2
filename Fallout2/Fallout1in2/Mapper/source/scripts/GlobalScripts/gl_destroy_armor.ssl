/*

   Should armor get destroyed on critter death?

*/

/* Include Files */
#include "define.h"
#include "command.h"

#include "sfall/main.h"

/* Standard Script Procedures */
procedure start;

procedure ondeath_handler;

procedure start begin
   if (game_loaded) then begin
      if fo1in2_destroy_armor_enabled then
         register_hook_proc(HOOK_ONDEATH, ondeath_handler);
   end
end

procedure ondeath_handler begin
   variable item, critter := get_sfall_arg;

   if (critter == dude_obj orElse (obj_in_party(critter))) then return;

   item = get_armor(critter);
   if (item andAlso obj_item_subtype(item) == item_type_armor) then begin
      rm_obj_from_inven(critter, item);
      debug_msg("Destroying critter armor!");
   end
end
